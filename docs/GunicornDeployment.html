---

title: Deploying with gunicorn


keywords: fastai
sidebar: home_sidebar

summary: "instructions on how to deploy a dashboard with gunicorn"
description: "instructions on how to deploy a dashboard with gunicorn"
nb_path: "03_GunicornDeployment.ipynb"
---
<!--

#################################################
### THIS FILE WAS AUTOGENERATED! DO NOT EDIT! ###
#################################################
# file to edit: 03_GunicornDeployment.ipynb
# command to build the docs after a change: nbdev_build_docs

-->

<div class="container" id="notebook-container">
        
    {% raw %}
    
<div class="cell border-box-sizing code_cell rendered">

</div>
    {% endraw %}

<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Example">Example<a class="anchor-link" href="#Example"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>An example dashboard can be found at <a href="https://github.com/oegedijk/dash_oop_demo">github.com/oegedijk/dash_oop_demo</a> and has been deployed to <a href="https://dash-oop-demo.herokuapp.com/">https://dash-oop-demo.herokuapp.com/</a></p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>First define the <a href="/dash_oop_components/core.html#DashFigureFactory"><code>DashFigureFactory</code></a> and <code>DashComponents</code> in <code>dashboard.components.py</code>. In this case I named them <code>CovidPlots</code> and <code>CovidDashboard</code>.</p>
<p>Then build the dashboard and save to <code>dashboard.yaml</code>:</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>build_dashboard.py</strong>:</p>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">dashboard_components</span> <span class="kn">import</span> <span class="n">CovidPlots</span><span class="p">,</span> <span class="n">CovidDashboard</span>
<span class="kn">from</span> <span class="nn">dash_bootstrap_components.themes</span> <span class="kn">import</span> <span class="n">FLATLY</span>
<span class="kn">from</span> <span class="nn">dash_oop_components</span> <span class="kn">import</span> <span class="n">DashApp</span>

<span class="n">plot_factory</span> <span class="o">=</span> <span class="n">CovidPlots</span><span class="p">(</span><span class="n">datafile</span><span class="o">=</span><span class="s2">&quot;covid.csv&quot;</span><span class="p">)</span>
<span class="n">dashboard_component</span> <span class="o">=</span> <span class="n">CovidDashboard</span><span class="p">(</span><span class="n">plot_factory</span><span class="p">)</span>
<span class="n">db</span> <span class="o">=</span> <span class="n">DashApp</span><span class="p">(</span><span class="n">dashboard_component</span><span class="p">,</span> <span class="n">external_stylesheets</span><span class="o">=</span><span class="p">[</span><span class="n">FLATLY</span><span class="p">])</span>
<span class="n">db</span><span class="o">.</span><span class="n">to_yaml</span><span class="p">(</span><span class="s2">&quot;dashboard.yaml&quot;</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Then define a <code>dashboard.py</code> that builds the dashboard from config, and exposes the Flask server:</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>dashboard.py</strong></p>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">dash_oop_components</span> <span class="kn">import</span> <span class="n">DashApp</span>

<span class="n">db</span> <span class="o">=</span> <span class="n">DashApp</span><span class="o">.</span><span class="n">from_yaml</span><span class="p">(</span><span class="s2">&quot;dashboard.yaml&quot;</span><span class="p">)</span>
<span class="n">app</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">server</span>
</pre></div>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>And start the gunicorn server:</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<div class="highlight"><pre><span></span>$ gunicorn --preload -b localhost:8050 dashboard:app
</pre></div>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Automatically-reloading-dashboard-whenever-config-changes">Automatically reloading dashboard whenever config changes<a class="anchor-link" href="#Automatically-reloading-dashboard-whenever-config-changes"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>You can also automatically restart the gunicorn server whenever there is a change to <code>dashboard.yaml</code>, by using <code>watchdog</code>. Install with <code>pip install watchdog[watchmedo]</code>. Start the gunicorn server while saving it's pid:</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<div class="highlight"><pre><span></span>$ gunicorn --pid gunicorn.pid --preload -b localhost:8050 dashboard:app
</pre></div>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>And the start a watchmedo script that runs <code>kill -HUP</code> on the gunicorn server in order to force a restart whenever it detects a change to <code>dashboard.yaml</code>:</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<div class="highlight"><pre><span></span>$ watchmedo shell-command -p <span class="s2">&quot;./dashboard.yaml&quot;</span> -c <span class="s1">&#39;kill -HUP $(cat gunicorn.pid)&#39;</span>
</pre></div>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Loading-with-pickled-DashFigureFactory">Loading with pickled <a href="/dash_oop_components/core.html#DashFigureFactory"><code>DashFigureFactory</code></a><a class="anchor-link" href="#Loading-with-pickled-DashFigureFactory"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>In some cases you might be doing some expensive calculations inside your <a href="/dash_oop_components/core.html#DashFigureFactory"><code>DashFigureFactory</code></a> that you do not want to run everytime you restart a dashboard as it would break the gunicorn timeout window. The solution is to build the plot_factory, pickle it, and then load it form the pickle file when you start the dashboard:</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>build_dashboard.py</strong>:</p>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">dashboard_components</span> <span class="kn">import</span> <span class="n">CovidPlots</span><span class="p">,</span> <span class="n">CovidDashboard</span>
<span class="kn">from</span> <span class="nn">dash_bootstrap_components.themes</span> <span class="kn">import</span> <span class="n">FLATLY</span>
<span class="kn">from</span> <span class="nn">dash_oop_components</span> <span class="kn">import</span> <span class="n">DashApp</span>

<span class="n">plot_factory</span> <span class="o">=</span> <span class="n">CovidPlots</span><span class="p">(</span><span class="n">datafile</span><span class="o">=</span><span class="s2">&quot;covid.csv&quot;</span><span class="p">)</span>
<span class="n">plot_factory</span><span class="o">.</span><span class="n">to_yaml</span><span class="p">(</span><span class="s1">&#39;plot_factory.yaml&#39;</span><span class="p">)</span>
<span class="n">plot_factory</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="s2">&quot;plot_factory.pkl&quot;</span><span class="p">)</span>

<span class="n">dashboard_component</span> <span class="o">=</span> <span class="n">CovidDashboard</span><span class="p">(</span><span class="n">plot_factory</span><span class="p">)</span>
<span class="n">dashboard</span><span class="o">.</span><span class="n">to_yaml</span><span class="p">(</span><span class="s2">&quot;dash_component.yaml&quot;</span><span class="p">)</span>

<span class="n">db</span> <span class="o">=</span> <span class="n">DashApp</span><span class="p">(</span><span class="n">dashboard_component</span><span class="p">,</span> <span class="n">external_stylesheets</span><span class="o">=</span><span class="p">[</span><span class="n">FLATLY</span><span class="p">])</span>
<span class="n">db</span><span class="o">.</span><span class="n">to_yaml</span><span class="p">(</span><span class="s2">&quot;dashboard.yaml&quot;</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Now you can load the plot_factory from disk. And you can use the fact that you can override parameters when loading with <code>.from_yaml()</code> by passing them as <code>**kwargs</code>:</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>dashboard.py:</strong></p>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">dash_oop_components</span> <span class="kn">import</span> <span class="n">DashFigureFactory</span><span class="p">,</span> <span class="n">DashComponent</span><span class="p">,</span> <span class="n">DashApp</span>

<span class="n">plot_factory</span> <span class="o">=</span> <span class="n">DashFigureFactory</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="s2">&quot;plot_factory.pkl&quot;</span><span class="p">)</span>
<span class="n">dashboard_component</span> <span class="o">=</span> <span class="n">DashComponent</span><span class="o">.</span><span class="n">from_yaml</span><span class="p">(</span><span class="s2">&quot;dash_component.yaml&quot;</span><span class="p">,</span> <span class="n">plot_factory</span><span class="o">=</span><span class="n">plot_factory</span><span class="p">)</span>
<span class="n">db</span> <span class="o">=</span> <span class="n">DashApp</span><span class="o">.</span><span class="n">from_yaml</span><span class="p">(</span><span class="s2">&quot;dashboard.yaml&quot;</span><span class="p">,</span> <span class="n">dashboard_component</span><span class="o">=</span><span class="n">dashboard_component</span><span class="p">)</span>
<span class="n">app</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">server</span>
</pre></div>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<h2 id="Fully-automated-build-and-redeploy-cycle">Fully automated build and redeploy cycle<a class="anchor-link" href="#Fully-automated-build-and-redeploy-cycle"> </a></h2>
</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>We can also you watchmedo to rebuild the <code>plot_factory</code> whenever there is a change to <code>plot_factory.yaml</code> or <code>covid.csv</code>,
and then rebuild the dashboard whenever there is a change to <code>plot_factory.pkl</code>, <code>dashboard_component.yaml</code> or <code>dashboard.yaml</code>:</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>build_plot_factory.py</strong>:</p>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">dash_oop_component</span> <span class="kn">import</span> <span class="n">DashFigureFactory</span>

<span class="n">plot_factory</span> <span class="o">=</span> <span class="n">DashFigureFactory</span><span class="o">.</span><span class="n">from_yaml</span><span class="p">(</span><span class="s2">&quot;plot_factory.yaml&quot;</span><span class="p">)</span>
<span class="n">plot_factory</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="s2">&quot;plot_factory.pkl&quot;</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>build_dashboard.py</strong>:</p>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">dashboard_components</span> <span class="kn">import</span> <span class="n">CovidPlots</span><span class="p">,</span> <span class="n">CovidDashboard</span>
<span class="kn">from</span> <span class="nn">dash_bootstrap_components.themes</span> <span class="kn">import</span> <span class="n">FLATLY</span>
<span class="kn">from</span> <span class="nn">dash_oop_components</span> <span class="kn">import</span> <span class="n">DashApp</span>

<span class="n">plot_factory</span> <span class="o">=</span> <span class="n">DashFigureFactory</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="s2">&quot;plot_factory.pkl&quot;</span><span class="p">)</span>
<span class="n">dashboard_component</span> <span class="o">=</span> <span class="n">CovidDashboard</span><span class="p">(</span><span class="n">plot_factory</span><span class="p">)</span>
<span class="n">db</span> <span class="o">=</span> <span class="n">DashApp</span><span class="p">(</span><span class="n">dashboard_component</span><span class="p">,</span> <span class="n">external_stylesheets</span><span class="o">=</span><span class="p">[</span><span class="n">FLATLY</span><span class="p">])</span>

<span class="n">dashboard</span><span class="o">.</span><span class="n">to_yaml</span><span class="p">(</span><span class="s2">&quot;dash_component.yaml&quot;</span><span class="p">)</span>
<span class="n">db</span><span class="o">.</span><span class="n">to_yaml</span><span class="p">(</span><span class="s2">&quot;dashboard.yaml&quot;</span><span class="p">)</span>
</pre></div>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p><strong>dashboard.py:</strong></p>
<div class="highlight"><pre><span></span><span class="kn">from</span> <span class="nn">dash_oop_components</span> <span class="kn">import</span> <span class="n">DashFigureFactory</span><span class="p">,</span> <span class="n">DashComponent</span><span class="p">,</span> <span class="n">DashApp</span>

<span class="n">plot_factory</span> <span class="o">=</span> <span class="n">DashFigureFactory</span><span class="o">.</span><span class="n">from_file</span><span class="p">(</span><span class="s2">&quot;plot_factory.pkl&quot;</span><span class="p">)</span>
<span class="n">dashboard_component</span> <span class="o">=</span> <span class="n">DashComponent</span><span class="o">.</span><span class="n">from_yaml</span><span class="p">(</span><span class="s2">&quot;dash_component.yaml&quot;</span><span class="p">,</span> <span class="n">plot_factory</span><span class="o">=</span><span class="n">plot_factory</span><span class="p">)</span>
<span class="n">db</span> <span class="o">=</span> <span class="n">DashApp</span><span class="o">.</span><span class="n">from_yaml</span><span class="p">(</span><span class="s2">&quot;dashboard.yaml&quot;</span><span class="p">,</span> <span class="n">dashboard_component</span><span class="o">=</span><span class="n">dashboard_component</span><span class="p">)</span>
<span class="n">app</span> <span class="o">=</span> <span class="n">db</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">server</span>
</pre></div>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Now start the gunicorn server with:</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<div class="highlight"><pre><span></span>$ gunicorn --pid gunicorn.pid --preload -b localhost:8050 dashboard:app
</pre></div>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>Now run the <code>build_plot_factory.py</code> script everytime you detect a change in either <code>covid.csv</code> or <code>plot_factory.yaml</code>:</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<div class="highlight"><pre><span></span>$ watchmedo shell-command -p <span class="s2">&quot;./covid.csv;./plot_factory.yaml&quot;</span> -c <span class="s1">&#39;python build_plot_factory.py&#39;</span>
</pre></div>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<p>And restart the gunicorn server everytime you detect a change to <code>plot_factory.pkl</code>, <code>dashboard_component.yaml</code> or <code>dashboard.yaml</code>:</p>

</div>
</div>
</div>
<div class="cell border-box-sizing text_cell rendered"><div class="inner_cell">
<div class="text_cell_render border-box-sizing rendered_html">
<div class="highlight"><pre><span></span>$ watchmedo shell-command -p <span class="s2">&quot;./plot_factory.pkl;./dashboard_component.yaml;./dashboard.yaml&quot;</span> -c <span class="s1">&#39;kill -HUP $(cat gunicorn.pid)&#39;</span>
</pre></div>

</div>
</div>
</div>
</div>
 

